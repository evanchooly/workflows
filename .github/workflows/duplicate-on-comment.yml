name: Duplicate Issue on Comment

# This workflow duplicates issues across multiple milestones
# Supports version-based matching and automatic milestone creation
#
# Usage examples:
#   /duplicate 2,3,4           - Find/create latest milestones for major versions
#   /duplicate 2.1,3.0         - Find/create latest milestones for minor versions
#   /duplicate v2.0.0          - Exact milestone match or create if not found
#   /duplicate 2.1.3,3,MyMilestone - Mix of version specs and exact milestone names

on:
  workflow_call:
    secrets:
      GH_TOKEN:
        required: true

jobs:
  duplicate-issue:
    if: |
      startsWith(github.event.comment.body, '/duplicate') &&
      (github.event.comment.author_association == 'OWNER' ||
       github.event.comment.author_association == 'MEMBER' ||
       github.event.comment.author_association == 'COLLABORATOR')

    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v6

      - name: Download File
        run: |
          curl -o "duplicate-issue.js" https://raw.githubusercontent.com/evanchooly/workflows/refs/heads/master/.github/scripts/duplicate-issue.js
        working-directory: ${{ github.workspace }}
      - name: Duplicate Issue Across Milestones
        uses: actions/github-script@v8
        with:
          github-token: ${{ secrets.GH_TOKEN }}
          script: |
            const script = require('./duplicate-issue.js');
            await script({github, context, core});